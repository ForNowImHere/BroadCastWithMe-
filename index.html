<!DOCTYPE html>
<html>
<head>
  <title>Remote Viewer</title>
  <style>
    body { background: #111; color: white; font-family: sans-serif; text-align: center; }
    canvas { border: 2px solid white; margin-top: 20px; cursor: crosshair; }
    input { margin: 5px; padding: 5px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>Remote Screen</h1>
  <div id="auth">
    <input id="user" placeholder="Username"><br>
    <input id="pass" placeholder="Password" type="password"><br>
    <input id="code" placeholder="Access Code"><br>
    <button onclick="connect()">Connect</button>
    <p id="status"></p>
  </div>
  <canvas id="screen" width="1280" height="720"></canvas>
  <script>
    let ws;
    let canvas = document.getElementById('screen');
    let ctx = canvas.getContext('2d');

    function connect() {
      ws = new WebSocket("ws://" + location.hostname + ":8765");
      ws.onopen = () => console.log("Connected to server");
      ws.onmessage = (e) => {
        let msg = JSON.parse(e.data);
        if (msg.type === "request_auth") {
          let user = document.getElementById("user").value;
          let pass = document.getElementById("pass").value;
          let code = document.getElementById("code").value;
          ws.send(JSON.stringify({type: "auth", username: user, password: pass, code: code}));
        } else if (msg.type === "auth_result") {
          document.getElementById("status").innerText = msg.message;
          if (!msg.success) ws.close();
        } else if (msg.type === "screen") {
          let img = new Image();
          img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          img.src = "data:image/jpeg;base64," + msg.data;
        }
      };
      canvas.onclick = (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = Math.floor((e.clientX - rect.left) * (1920 / canvas.width));
        const y = Math.floor((e.clientY - rect.top) * (1080 / canvas.height));
        ws.send(JSON.stringify({type: "click", x: x, y: y}));
      };
    }
  </script>
</body>
</html>
