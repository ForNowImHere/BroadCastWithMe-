<!DOCTYPE html>
<html>
<head>
    <title>Secure WebSocket</title>
</head>
<body>
    <div id="auth">
        <h2>Login</h2>
        <input id="username" placeholder="Username"><br>
        <input id="password" placeholder="Password"><br>
        <input id="code" placeholder="Access Code"><br>
        <button onclick="login()">Login</button>
    </div>

    <div id="main" style="display:none">
        <h2>Welcome!</h2>
        <button onclick="sendPing()">Send Ping</button>
        <input id="echoInput" placeholder="Say something">
        <button onclick="sendEcho()">Send Echo</button>
        <pre id="log"></pre>
    </div>

    <script>
        let ws;

        function log(msg) {
            document.getElementById('log').textContent += msg + "\n";
        }

        function login() {
            ws = new WebSocket("wss://c9c0e85af4a2.ngrok-free.app");

            ws.onopen = () => {
                ws.send(JSON.stringify({
                    username: document.getElementById("username").value,
                    password: document.getElementById("password").value,
                    code: document.getElementById("code").value
                }));
            };

            ws.onmessage = (msg) => {
                const data = JSON.parse(msg.data);
                if (data.type === "auth_result") {
                    log(data.message);
                    if (data.success) {
                        document.getElementById("auth").style.display = "none";
                        document.getElementById("main").style.display = "block";
                    }
                } else if (data.type === "pong") {
                    log("Received pong!");
                } else if (data.type === "echo") {
                    log("Echo: " + data.message);
                } else {
                    log("Other: " + msg.data);
                }
            };
        }

        function sendPing() {
            ws.send(JSON.stringify({type: "ping"}));
        }

        function sendEcho() {
            let msg = document.getElementById("echoInput").value;
            ws.send(JSON.stringify({type: "echo", message: msg}));
        }
    </script>
</body>
</html>
